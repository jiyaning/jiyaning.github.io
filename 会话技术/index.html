<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>会话技术 | web前端开发</title>
    <meta name="description" content="个人博客">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.46bdbf49.css" as="style"><link rel="preload" href="/assets/js/app.549ab972.js" as="script"><link rel="preload" href="/assets/js/2.ecc2fa6f.js" as="script"><link rel="preload" href="/assets/js/30.98cc88b4.js" as="script"><link rel="prefetch" href="/assets/js/10.4ce75836.js"><link rel="prefetch" href="/assets/js/11.4771b230.js"><link rel="prefetch" href="/assets/js/12.f03499bf.js"><link rel="prefetch" href="/assets/js/13.2c65fd33.js"><link rel="prefetch" href="/assets/js/14.a5be85de.js"><link rel="prefetch" href="/assets/js/15.428dd0c3.js"><link rel="prefetch" href="/assets/js/16.4b3bd144.js"><link rel="prefetch" href="/assets/js/17.0dd718db.js"><link rel="prefetch" href="/assets/js/18.0a392d7a.js"><link rel="prefetch" href="/assets/js/19.a3f55a97.js"><link rel="prefetch" href="/assets/js/20.46e8e003.js"><link rel="prefetch" href="/assets/js/21.9a036560.js"><link rel="prefetch" href="/assets/js/22.4ff0af16.js"><link rel="prefetch" href="/assets/js/23.cce2bed4.js"><link rel="prefetch" href="/assets/js/24.12c7b7d3.js"><link rel="prefetch" href="/assets/js/25.644b21f7.js"><link rel="prefetch" href="/assets/js/26.ff2f0716.js"><link rel="prefetch" href="/assets/js/27.02ade99e.js"><link rel="prefetch" href="/assets/js/28.57829572.js"><link rel="prefetch" href="/assets/js/29.ca9097ef.js"><link rel="prefetch" href="/assets/js/3.49ef6df2.js"><link rel="prefetch" href="/assets/js/31.98cff12d.js"><link rel="prefetch" href="/assets/js/32.de6c6cb5.js"><link rel="prefetch" href="/assets/js/4.e43a75b1.js"><link rel="prefetch" href="/assets/js/5.fffb226e.js"><link rel="prefetch" href="/assets/js/6.f0f6a59d.js"><link rel="prefetch" href="/assets/js/7.fd46d82f.js"><link rel="prefetch" href="/assets/js/8.0a7d41ba.js"><link rel="prefetch" href="/assets/js/9.20648608.js">
    <link rel="stylesheet" href="/assets/css/0.styles.46bdbf49.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">web前端开发</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML" class="dropdown-title"><span class="title">HTML</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/html/html5/" class="nav-link">
  HTML5
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><span class="title">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/css/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/css/css3/" class="nav-link">
  CSS3
</a></li></ul></div></div><div class="nav-item"><a href="/Flex/" class="nav-link">
  Flex
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS" class="dropdown-title"><span class="title">JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/js基础/" class="nav-link">
  JS基础
</a></li><li class="dropdown-item"><!----> <a href="/js/js高级/" class="nav-link">
  JS高级
</a></li><li class="dropdown-item"><!----> <a href="/js/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/js/正则表达式/" class="nav-link">
  正则
</a></li></ul></div></div><div class="nav-item"><a href="/jquery/" class="nav-link">
  Jquery
</a></div><div class="nav-item"><a href="/Web API/" class="nav-link">
  Web API
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Ajax" class="dropdown-title"><span class="title">Ajax</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ajax/ajax/" class="nav-link">
  Ajax
</a></li><li class="dropdown-item"><!----> <a href="/ajax/axios/" class="nav-link">
  Axios
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/vue基础/" class="nav-link">
  vue基础
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue核心/" class="nav-link">
  vue核心
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  vuex
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react基础/" class="nav-link">
  react基础
</a></li><li class="dropdown-item"><!----> <a href="/react/react核心/" class="nav-link">
  react核心
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/node/Express/" class="nav-link">
  Express
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/ .html" class="nav-link">
  mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTTP/" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/websocket/" class="nav-link">
  webSocket
</a></li><li class="dropdown-item"><!----> <a href="/会话技术/" class="nav-link">
  会话技术
</a></li><li class="dropdown-item"><!----> <a href="/模板引擎/" class="nav-link">
  模板引擎
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jiyaning" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML" class="dropdown-title"><span class="title">HTML</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/html/html5/" class="nav-link">
  HTML5
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><span class="title">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/css/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/css/css3/" class="nav-link">
  CSS3
</a></li></ul></div></div><div class="nav-item"><a href="/Flex/" class="nav-link">
  Flex
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS" class="dropdown-title"><span class="title">JS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/js/js基础/" class="nav-link">
  JS基础
</a></li><li class="dropdown-item"><!----> <a href="/js/js高级/" class="nav-link">
  JS高级
</a></li><li class="dropdown-item"><!----> <a href="/js/ES6/" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/js/正则表达式/" class="nav-link">
  正则
</a></li></ul></div></div><div class="nav-item"><a href="/jquery/" class="nav-link">
  Jquery
</a></div><div class="nav-item"><a href="/Web API/" class="nav-link">
  Web API
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Ajax" class="dropdown-title"><span class="title">Ajax</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ajax/ajax/" class="nav-link">
  Ajax
</a></li><li class="dropdown-item"><!----> <a href="/ajax/axios/" class="nav-link">
  Axios
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/vue基础/" class="nav-link">
  vue基础
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue核心/" class="nav-link">
  vue核心
</a></li><li class="dropdown-item"><!----> <a href="/vue/vuex/" class="nav-link">
  vuex
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React" class="dropdown-title"><span class="title">React</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/react/react基础/" class="nav-link">
  react基础
</a></li><li class="dropdown-item"><!----> <a href="/react/react核心/" class="nav-link">
  react核心
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/node/node/" class="nav-link">
  node
</a></li><li class="dropdown-item"><!----> <a href="/node/Express/" class="nav-link">
  Express
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mysql/ .html" class="nav-link">
  mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTTP/" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/websocket/" class="nav-link">
  webSocket
</a></li><li class="dropdown-item"><!----> <a href="/会话技术/" class="nav-link">
  会话技术
</a></li><li class="dropdown-item"><!----> <a href="/模板引擎/" class="nav-link">
  模板引擎
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/jiyaning" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>会话技术</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_1-会话控制" class="sidebar-link">1. 会话控制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_2-cookie" class="sidebar-link">2. cookie</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_2-1-查看cookie" class="sidebar-link">2.1. 查看cookie</a></li><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_2-2-理解cookie" class="sidebar-link">2.2. 理解cookie</a></li><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_2-3-从服务器发送cookie给客户端" class="sidebar-link">2.3. 从服务器发送cookie给客户端</a></li><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_2-4-cookie详细设置" class="sidebar-link">2.4. cookie详细设置</a></li><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_2-5-cookie设置有效期" class="sidebar-link">2.5. cookie设置有效期</a></li><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_2-6-在服务器端获取cookie" class="sidebar-link">2.6. 在服务器端获取cookie</a></li><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_2-7-删除cookie" class="sidebar-link">2.7. 删除cookie</a></li></ul></li><li><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_3-session" class="sidebar-link">3. session</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_3-1-session使用" class="sidebar-link">3.1. session使用</a></li><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_3-2-设置session" class="sidebar-link">3.2. 设置session</a></li><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_3-3-获取session" class="sidebar-link">3.3. 获取session</a></li><li class="sidebar-sub-header"><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_3-4-删除session" class="sidebar-link">3.4. 删除session</a></li></ul></li><li><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_4-cookie和session的原理" class="sidebar-link">4. cookie和session的原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/#_5-cookie和session的优缺点" class="sidebar-link">5. cookie和session的优缺点</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="会话技术"><a href="#会话技术" class="header-anchor">#</a> 会话技术</h1> <p>很多网站都有登录功能：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>|--login.html (登录页)
|--index.html(主页)
|--setting.html(设置页)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><p>实际开发，必须解决页面之间的数据共享问题：例如用户从login.html页面登陆之后，再去访问index.html或者setting.html页面时，应该还是能够获取用户的登陆信息。</p></li> <li><p>由于 http是无状态的，就是无记忆的，对于HTTP协议而言，无状态同样指每次request请求之前是相互独立的，当前请求并不会记录它的上一次请求信息。每次请求都是独立的，没有关联的，所以服务器和客户端都不知道是否是登录过的。</p></li></ul> <h2 id="_1-会话控制"><a href="#_1-会话控制" class="header-anchor">#</a> 1. 会话控制</h2> <ul><li><p>会话控制就是用来弥补http无记忆的缺陷的一种技术。它能够将数据持久化（保存数据）的保存在客户端(浏览器)或者服务器端，从而让浏览器和服务器进行多次数据交换时，产生连续性。</p></li> <li><p>让每一次的请求和响应都知道对方是谁。</p></li></ul> <blockquote><p>客户端第一次请求服务端后，服务端进行响应时，给客户端发送一个cookie，</p> <p>下发的操作在响应头中，是一个set-cookie。</p></blockquote> <blockquote><p>客户端接收到响应信息后，浏览器会自动读取cookie并保存在本地，</p> <p>以后再次发送请求时，浏览器会自动将cookie信息添加在请求头中发送给服务端。</p></blockquote> <p><code>会话控制的分类:</code></p> <ul><li>cookie： 将数据保存到<strong>客户端</strong>（浏览器）</li> <li>session： 将数据保存到<strong>服务器端</strong></li></ul> <h2 id="_2-cookie"><a href="#_2-cookie" class="header-anchor">#</a> 2. cookie</h2> <h3 id="_2-1-查看cookie"><a href="#_2-1-查看cookie" class="header-anchor">#</a> 2.1. 查看cookie</h3> <ol><li>在浏览器中查看:</li></ol> <ul><li>在application--&gt; cookie中查看。</li></ul> <ol start="2"><li>在发送请求时的请求头中查看</li></ol> <h3 id="_2-2-理解cookie"><a href="#_2-2-理解cookie" class="header-anchor">#</a> 2.2. 理解cookie</h3> <ul><li>cookie是将数据持久化（保存）存储到客户端（浏览器）的一种技术</li> <li>cookie是<strong>键值对格式的字符串</strong></li> <li>可以通过浏览器查看某个网站的cookie</li> <li>如果浏览器保存了cookie，则向服务器发请求时，就会<strong>自动带上这个cookie</strong>。
<ul><li>把cookie放在请求头中，发送给服务器。</li></ul></li></ul> <img src="https://jiyaning.github.io/staticImgs/images/cookie.png"> <h3 id="_2-3-从服务器发送cookie给客户端"><a href="#_2-3-从服务器发送cookie给客户端" class="header-anchor">#</a> 2.3. 从服务器发送cookie给客户端</h3> <p><code>原生的方法:</code></p> <ol><li>设置单个cookie</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//在nodejs中，通过res.setHeader来设置响应头。</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'set-cookie'</span><span class="token punctuation">,</span> <span class="token string">'name=curry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>设置多个cookie</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//在nodejs中，通过res.setHeader来设置响应头。</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'set-cookie'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'name=curry'</span><span class="token punctuation">,</span> <span class="token string">'age=30'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>如果cookie值是中文的话，还要对这个值进行额外的编码。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'好汉'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//5aW95rGJ</span>
<span class="token keyword">var</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'5aW95rGJ'</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>express中提供的方法:</code></p> <p>express框架给提供了一个res.cookie方法，用来设置cookie</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>res.cookie(cookie名, cookie值,{其它属性});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-4-cookie详细设置"><a href="#_2-4-cookie详细设置" class="header-anchor">#</a> 2.4. cookie详细设置</h3> <ul><li><p>参考：https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie</p></li> <li><p>从服务器端，发送cookie给客户端，是通过设置Set-Cookie这个特殊的响应头来实现的。包括了对应的cookie的名称，值，以及各个属性。</p></li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code>Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span> 
Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span>; Expires=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>date</span><span class="token punctuation">&gt;</span></span>
Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span>; Max-Age=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>non-zero-digit</span><span class="token punctuation">&gt;</span></span>
Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span>; Domain=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>domain-value</span><span class="token punctuation">&gt;</span></span>
Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span>; Path=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path-value</span><span class="token punctuation">&gt;</span></span>
Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span>; Secure
Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span>; HttpOnly
Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span>; SameSite=Strict
Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span>; SameSite=Lax

// Multiple directives are also possible, for example:
Set-Cookie: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-name</span><span class="token punctuation">&gt;</span></span>=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cookie-value</span><span class="token punctuation">&gt;</span></span>; Domain=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>domain-value</span><span class="token punctuation">&gt;</span></span>; Secure; HttpOnly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>一个cookie所具有的主要属性包括：</p> <ul><li>Domain：域，表示当前cookie所属于哪个域或子域下面。对于服务器返回的Set-Cookie中，如果没有指定Domain的值，那么其Domain的值是默认为当前所提交的http的请求所对应的主域名的。比如访问 http://www.example.com，返回一个cookie，没有指名domain值，那么其为值为默认的www.example.com。</li> <li>Path：表示cookie的所属路径。</li> <li>Expire time/Max-age：表示了cookie的有效期。expire的值，是一个时间，过了这个时间，该cookie就失效了。或者是用max-age指定当前cookie是在多长时间之后而失效。如果服务器返回的一个cookie，没有指定其expire time，那么表明此cookie有效期只是当前的session，即是session cookie，当前session会话结束后，就过期了。对应的，当关闭（浏览器中）该页面的时候，此cookie就应该被浏览器所删除了。</li> <li>secure：表示该cookie只能用https传输。一般用于包含认证信息的cookie，要求传输此cookie的时候，必须用https传输。</li> <li>httponly：表示此cookie必须用于http或https传输。这意味着，浏览器脚本是不允许访问操作此cookie的(document.cookie不能访问)。</li></ul> <h3 id="_2-5-cookie设置有效期"><a href="#_2-5-cookie设置有效期" class="header-anchor">#</a> 2.5. cookie设置有效期</h3> <p>expires字段是设置cookie在哪段时间内是有效的。需要注意，时间格式是UTC时间格式（ 不是中国时间）。</p> <p>具体的语法是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;cooke-name=cookie-value;expires=UTC时间&quot;</span>

<span class="token comment">// 如下示例</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'set-cookie'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'id=1;expires='</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 表示id=1这个cookies在5秒之后失效</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果使用express带的setCookie，则可以</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'loginStatus'</span><span class="token punctuation">,</span> <span class="token string">'yes'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    expires<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-6-在服务器端获取cookie"><a href="#_2-6-在服务器端获取cookie" class="header-anchor">#</a> 2.6. 在服务器端获取cookie</h3> <ol><li>手动解析</li></ol> <p>向服务器发送的请求中会自动携带cookie，具体来说它会在req.headers.cookie中保存。要注意取到的cookie中只包括键值对，而cookies的属性（如过期时间）是看不到的。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span> <span class="token comment">//isLogin=true; name=xsfss</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个字符中包含了全部的cookie，为了把它们的值解析出来成一个对象，可以通过node的核心对象querystring来进行解析。传统的获取方式，数据形式很难操作</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 1. 把; 替换成&amp;，以让querystring能够解析</span>
<span class="token keyword">let</span> cookiestr <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'; '</span><span class="token punctuation">,</span> <span class="token string">'&amp;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cookiestr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2 解析成对象</span>
<span class="token keyword">let</span> cookieObj <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cookiestr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> isLogin<span class="token punctuation">,</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> cookieObj<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>使用cookie-parser进行解析</li></ol> <ul><li><p>使用cookie-parser中间件对cookie数据进行转换，可以快速解析</p></li> <li><p>req.cookies 用于获取cookie数据,获取到的是对象形式的cookie数据</p> <p>安装cookie-parser</p></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> cookie-parser
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>​     使用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 为了转换cookie数据的格式，可以使用第三方模块cookie-parser</span>
<span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用cp模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 某个具体的路由回调函数中，cookies会以对象的格式保存在req对象中</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置登录状态检测接口</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/loginStatus'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 检测cookie中的loginStatus的值是否为yes</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>loginStatus <span class="token operator">===</span> <span class="token string">'yes'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
      msg<span class="token operator">:</span> <span class="token string">'已经登录过'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
      msg<span class="token operator">:</span> <span class="token string">'没有登录过'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_2-7-删除cookie"><a href="#_2-7-删除cookie" class="header-anchor">#</a> 2.7. 删除cookie</h3> <p>express框架提供了一个删除方法。从服务器端删除:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//设置退出接口</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 清除cookie的方式</span>
    res<span class="token punctuation">.</span><span class="token function">clearCookie</span><span class="token punctuation">(</span><span class="token string">'loginStatus'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置重定向到登录页面即可</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_3-session"><a href="#_3-session" class="header-anchor">#</a> 3. session</h2> <ul><li>普通cookie的数据是保存在客户端中，用户可以随意查看、修改，普通的cookie是不太安全的</li> <li>如果用户手动设置loginStatus为yes，即便没有真的登录，也可以访问index.html</li></ul> <blockquote><p>session的本质就是cookie的一种特殊用法而已,</p> <p>session的数据是保存在服务端，将保存数据的区域标记(称为sessionId)下发给客户端保存</p> <p>下次请求发送到服务端时，这个标记也会自动发送到服务端，服务端再进行数据操作</p></blockquote> <ul><li>注意：并不是说session安全，就所有功能都必须使用session,
<ul><li>例如点击''关闭广告7天不在显示''的这种记录功能，使用普通的cookie即可</li></ul></li></ul> <p><code>session原理：</code></p> <ul><li>session 从字面上讲，就是会话。</li> <li>服务器要知道当前发请求给自己的是谁。为了做这种区分，服务器就要给每个客户端分配不同的“身份标识”，然后客户端每次向服务器发请求的时候，都带上这个“身份标识”，服务器就知道这个请求来自于谁了。</li> <li>至于客户端怎么保存这个“身份标识”，可以有很多种方式，对于浏览器客户端，默认采用 cookie 的方式来保存这个身份标记。</li> <li>服务器使用session把用户的信息临时保存在了服务器上，用户离开网站后session会被销毁。</li> <li>这种用户信息存储方式相对cookie来说更安全，可是session有一个缺陷：如果web服务器做了负载均衡，那么下一个操作请求到了另一台服务器的时候session会丢失。或者服务器重启了session数据也会丢失。</li></ul> <h3 id="_3-1-session使用"><a href="#_3-1-session使用" class="header-anchor">#</a> 3.1. session使用</h3> <blockquote><p>session处理需要使用express-session的中间件进行处理操作</p></blockquote> <p>先安装express-session包，再使用</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i express-session
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//1. 引入express-session包</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2.配置express-session模块</span>
<span class="token keyword">let</span> conf <span class="token operator">=</span> <span class="token punctuation">{</span>
    secret<span class="token operator">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span> <span class="token comment">//加密字符串。 使用该字符串来加密session数据，自定义</span>
    resave<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//强制保存session即使它并没有变化</span>
    saveUninitialized<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//强制将未初始化的session存储。</span>
    <span class="token comment">//当新建了一个session且未设定属性或值时，它就处于未初始化状态。</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//3. 注册为express-session中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_3-2-设置session"><a href="#_3-2-设置session" class="header-anchor">#</a> 3.2. 设置session</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1 设置登录接口进行登录信息检测</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2 保存用户名和密码</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> username<span class="token operator">:</span> uname<span class="token punctuation">,</span> password<span class="token operator">:</span> pwd <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    <span class="token comment">// 3 进行检测（admin和123456为正确）</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>uname <span class="token operator">===</span> <span class="token string">'admin'</span> <span class="token operator">&amp;&amp;</span> pwd <span class="token operator">===</span> <span class="token string">'123456'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 设置session中的数据</span>
        <span class="token comment">// req.session是一个用于管理session信息的对象，可以进行读写操作</span>
        req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>loginStatus <span class="token operator">=</span> <span class="token string">'yes'</span><span class="token punctuation">;</span>
        <span class="token comment">//  - 可以从服务端设置重定向操作(重定向指的是服务端设置的一种跳转)</span>
        res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8000/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> <span class="token string">'登录成功'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> <span class="token string">'登录失败'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_3-3-获取session"><a href="#_3-3-获取session" class="header-anchor">#</a> 3.3. 获取session</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 2 设置登录状态检测接口</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/loginStatus'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 2.1 检测session中的loginStatus的值是否为yes</span>
    <span class="token comment">// session的值可以是任何的数据类型，比如布尔，数组，对象等</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>loginStatus <span class="token operator">===</span> <span class="token string">'yes'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            status<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> <span class="token string">'已经登录过'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            status<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
            msg<span class="token operator">:</span> <span class="token string">'没有登录过'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_3-4-删除session"><a href="#_3-4-删除session" class="header-anchor">#</a> 3.4. 删除session</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 3 设置退出接口</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 清除session的方式</span>
    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 设置重定向到登录页面即可</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_4-cookie和session的原理"><a href="#_4-cookie和session的原理" class="header-anchor">#</a> 4. cookie和session的原理</h2> <p>cookie原理：</p> <ul><li>从服务器端向客户端留下信息，每次访问时都带上</li></ul> <p>session原理：</p> <ul><li>服务器端会为每个用户（浏览器）各自保存一个session（文件）。当服务器保存session之后，会以cookie的形式告诉浏览器，你的session号是哪一个。它把session号返回给了浏览器，而把真实的数据保存在服务器。</li> <li>下次再来访问服务器的时候，浏览器就会带着它自己的session号去访问，服务器根据session号就可以找到对应的session了。</li></ul> <h2 id="_5-cookie和session的优缺点"><a href="#_5-cookie和session的优缺点" class="header-anchor">#</a> 5. cookie和session的优缺点</h2> <p>cookie：优点是节省服务器空间，缺点不安全。不要保存敏感信息。</p> <p>session：优点是安全，缺点需要服务器空间， 是一种最常见的解决方案。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.549ab972.js" defer></script><script src="/assets/js/2.ecc2fa6f.js" defer></script><script src="/assets/js/30.98cc88b4.js" defer></script>
  </body>
</html>
